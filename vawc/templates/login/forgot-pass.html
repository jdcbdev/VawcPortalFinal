{% extends "../base/base.html" %}
{% block title %}Forgot Password{% endblock %}
{% load static %}
{% block content %}
<div class="container pt-5 pb-5">
    <div class="card">
        <div class="card-body p-0">
            <div class="row g-0 align-items-center">
                <div class="col-lg-6 d-none d-md-flex align-items-center justify-content-center position-relative">
                    <img src="{% static '/img/mesh-757.png' %}" class="img-fluid w-100 h-100 object-fit-cover rounded-start" alt="Forgot Password">
                    
                    <div class="typing-container">
                        <p class="typing-text"></p>
                    </div>
                </div>

                <div class="col-lg-6 col-md-12 col-sm-12 d-flex flex-column justify-content-center p-4">
                    <h2 class="text-center fw-light" style="color: purple;">Forgot Password</h2>
                    <p class="text-center" style="color: purple;">Enter your email to recover your password</p>

                    <form id="forgotPassForm" method="post">
                        {% csrf_token %}

                        <div class="mb-3">
                            <input type="email" class="form-control input-purple" style="border: 1px solid #c0adcc" placeholder="Email" id="barangay-email" name="barangay-email" required>
                            <div id="barangay-emailFeedback" class="invalid-feedback">
                                Please enter a valid email.
                            </div>
                        </div>

                        <button id="submitButton" class="btn btn-primary w-100" type="submit">
                            Recover Password
                        </button>

                        <a href="{% url 'login' %}" class="btn btn-outline-primary w-100 mt-2">Login instead</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal success -->
<div class="modal fade" id="successmodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel">Success</h1>
        </div>
        <div class="modal-body">
            <div class="wrapper"> <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"> <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/> <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            </div>
            <h3 class="text-center">Success</h3>
            <p class="py-1 fs-4 text-center">A link has been sent to this account</p>
        </div>
        <div class="modal-footer">
            <a type="button" class="btn btn-primary" href="{% url 'login' %}">Back to Login Page</a>
        </div>
        </div>
    </div>
</div>

{% endblock content %}
{% block scripts %}
<script>
    $(document).ready(function() {
        $('#forgotPassForm').on('submit', function(event) {
            event.preventDefault();  // Prevent the default form submission behavior
        
            // Get the email input value
            var email = $('#barangay-email').val();
        
            // Send AJAX request to the view
            $.ajax({
                type: 'GET',
                url: '{% url "forgot_pass_sent" %}',
                data: {'email': email},
                dataType: 'json',
                success: function(response) {
                    console.log(response);
                    if (response.success) {
                        // Show the success modal
                        $('#successmodal').modal('show');
                    } else {
                        // If email does not exist, add is-invalid class to the input and display invalid feedback
                        $('#barangay-email').addClass('is-invalid');
                        $('#barangay-emailFeedback').text('Email does not exist.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    // Handle other errors if needed
                }
            });
        });
    });
</script>
{% endblock scripts %}